{"version":3,"sources":["GameServer.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"..\\..\\..\\..\\assets\\script","sourcesContent":["import GameServerData from \"./GameServerData\";\r\nconst { ccclass, property } = cc._decorator;\r\n\r\nexport enum Phase {\r\n    Waiting = 0,\r\n    Betting = 1,\r\n    BetEnd = 2,\r\n    Result = 3,\r\n    Ending = 4\r\n\r\n}\r\n\r\n@ccclass\r\nexport default class GameServer extends cc.Component {\r\n\r\n\r\n    @property\r\n    protected GameStage: number = 0;\r\n\r\n    @property\r\n    TotalRound: number = 0;\r\n\r\n    @property\r\n    TimeRemain: number = 0;\r\n\r\n\r\n    @property\r\n    Data: GameServerData = null;\r\n\r\n    @property\r\n    PokerCard: number[] = [-1, -1];\r\n\r\n    @property\r\n    Winner: number = -1;\r\n    @property\r\n    TotalBets: number[] = [0, 0, 0];\r\n\r\n\r\n    readonly EmptyAres: number[] = [0, 0, 0];\r\n\r\n\r\n\r\n    ws: WebSocket = new WebSocket(\"ws://localhost:2346/\");\r\n\r\n\r\n\r\n\r\n\r\n\r\n    // LIFE-CYCLE CALLBACKS:\r\n\r\n\r\n    onLoad() {\r\n        let self = this;\r\n        this.Data = this.getComponent(\"GameServerData\");\r\n\r\n        console.log(\"Game Start!\");\r\n\r\n        this.register_evnet();\r\n        this.ws.onopen = function (event) {\r\n            console.log(\"Send Text WS was opened.\");\r\n        };\r\n        this.ws.onmessage = function (event) {\r\n            self.gameProcess(event.data);\r\n            console.log(typeof (event.data) + \" \" + event.data);\r\n        };\r\n    }\r\n\r\n\r\n\r\n\r\n\r\n    start() {\r\n        // this.gameProcess();\r\n    }\r\n\r\n    // update(dt) { }\r\n\r\n\r\n    register_evnet() {\r\n        let self = this;\r\n        cc.game.on(\"receiveLocalBet\", function receiveLocalBet(name: string, amount: number, area: number) {\r\n            self.TotalBets[area] += +amount;\r\n            self.Data.PlayerMoney = -amount;\r\n        })\r\n\r\n        cc.game.on(\"getCard\", function getCard() {\r\n            cc.game.emit(\"returnCard\", self.PokerCard)\r\n        })\r\n    }\r\n\r\n    public gameProcess(stage: string) {\r\n        switch (stage) {\r\n            case \"waiting\":\r\n                cc.game.emit(\"updatePlayerInformation\", this.getPlayerName(), this.getPlayerMoney())\r\n                this.gameWait(stage);\r\n                break;\r\n            case \"bet\":\r\n                this.bet(stage);\r\n                break;\r\n            case \"bet end\":\r\n                this.betFinish(stage);\r\n                break;\r\n            case \"show\":\r\n                this.showResult(stage);\r\n                break;\r\n            case \"end\":\r\n                cc.game.emit(\"updatePlayerInformation\", this.getPlayerName(), this.getPlayerMoney())\r\n                this.roundEnd(stage);\r\n            default:\r\n                break;\r\n        }\r\n    }\r\n    public gameWait(stage: string) {\r\n        console.log(\"Now is \" + (++this.TotalRound) + \" round\");\r\n        cc.game.emit(\"changeStage\", stage)\r\n    }\r\n    public bet(stage: string) {\r\n        cc.game.emit(\"changeStage\", stage)\r\n    }\r\n    public betFinish(stage: string) {\r\n        console.log(\"Server bets \" + this.TotalBets);\r\n        cc.game.emit(\"changeStage\", stage)\r\n        this.PokerCard = this.creatCard();\r\n        this.cardResult();\r\n    }\r\n    public showResult(stage: string) {\r\n        this.dealWithMoney()\r\n        cc.game.emit(\"changeStage\", stage)\r\n    }\r\n    public roundEnd(stage: string) {\r\n        console.log(\"round end\");\r\n        cc.game.emit(\"changeStage\", stage)\r\n        this.PokerCard = [-1, -1]\r\n        this.Winner = -1;\r\n        this.TotalBets = [...this.EmptyAres];\r\n        console.log(\"round end bets \" + this.TotalBets);\r\n    }\r\n\r\n    public getPlayerName(): string {\r\n        return this.Data.PlayerName;\r\n    }\r\n    public getPlayerMoney() {\r\n        return this.Data.PlayerMoney;\r\n    }\r\n\r\n    private creatCard() {\r\n        let rdmArray = [2];\r\n\r\n        for (let i = 0; i < 2; i++) {\r\n            let rdm = 0;\r\n\r\n            do {\r\n                var exist = false;\r\n                rdm = Math.floor(Math.random() * 52);\r\n\r\n\r\n                if (rdmArray.indexOf(rdm) != -1) exist = true;\r\n\r\n            } while (exist);\r\n\r\n            rdmArray[i] = rdm;\r\n        }\r\n        return rdmArray;\r\n    }\r\n    private cardResult() {\r\n        console.log(\"Dora: \" + (this.PokerCard[0] % 13) + \" Tora: \" + (this.PokerCard[1] % 13));\r\n        if ((this.PokerCard[0] % 13) > (this.PokerCard[1] % 13)) {\r\n            this.Winner = 0;\r\n        } else if ((this.PokerCard[0] % 13) < (this.PokerCard[1] % 13)) {\r\n            this.Winner = 2;\r\n        } else {\r\n            this.Winner = 1;\r\n        }\r\n        console.log(\"Winner is \" + this.Winner);\r\n\r\n    }\r\n\r\n\r\n    private dealWithMoney() {\r\n        if (this.Winner === 1) {\r\n            this.Data.PlayerMoney = (this.TotalBets[this.Winner] * 9);\r\n        } else {\r\n            this.Data.PlayerMoney = (this.TotalBets[this.Winner] * 2);\r\n        }\r\n    }\r\n\r\n\r\n\r\n}\r\n\r\n"]}